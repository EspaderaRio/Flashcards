<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcards</title>
<link rel="manifest" href="manifest.json">

   <script>
     // ===================== ELEMENT SDK ===================== //

(function () {

  const elementSdk = {
    config: {},

    init({ defaultConfig, onConfigChange, mapToCapabilities, mapToEditPanelValues }) {
      // Load config from dataSdk or fallback
      const saved = window.dataSdk ? window.dataSdk.loadConfig() : null;
      this.config = saved || defaultConfig;

      // Expose callbacks
      this.onConfigChange = onConfigChange;
      this.mapToCapabilities = mapToCapabilities;
      this.mapToEditPanelValues = mapToEditPanelValues;

      // Inform the UI to update
      onConfigChange(this.config);
    },

    setProperty(key, value) {
      this.config[key] = value;
      window.dataSdk.saveConfig(this.config);
      this.onConfigChange(this.config);
    }
  };

  window.elementSdk = elementSdk;
})();

  </script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #1a1a1a;
      overflow-x: hidden;
      height: 100%;
    }

    html {
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 16px;
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      padding-top: 8px;
    }

    .header h1 {
      margin: 0 0 8px 0;
      font-size: 28px;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .tab {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(255,255,255,0.2);
      color: white;
    }

    .tab.active {
      background: white;
      color: #667eea;
    }

    .tab:active {
      transform: scale(0.98);
    }

    .deck-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 16px;
      color: white;
    }

    .deck-name {
      font-size: 14px;
      font-weight: 600;
    }

    .position {
      font-size: 14px;
      opacity: 0.9;
    }

    .card-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      perspective: 1000px;
      min-height: 280px;
    }

    .card {
      width: 100%;
      height: 280px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
      cursor: pointer;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      border-radius: 20px;
      background: white;
      font-size: 20px;
      font-weight: 500;
      text-align: center;
      line-height: 1.5;
      overflow-y: auto;
    }

    .card-face.back {
      transform: rotateY(180deg);
      background: #f8f9fa;
    }

    .nav-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .nav-buttons button {
      flex: 1;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
    }

    .btn-prev {
      background: rgba(255,255,255,0.2);
    }

    .btn-prev:active {
      background: rgba(255,255,255,0.3);
      transform: scale(0.98);
    }

    .btn-flip {
      background: rgba(255,255,255,0.95);
      color: #667eea;
    }

    .btn-flip:active {
      background: rgba(255,255,255,1);
      transform: scale(0.98);
    }

    .btn-next {
      background: rgba(255,255,255,0.2);
    }

    .btn-next:active {
      background: rgba(255,255,255,0.3);
      transform: scale(0.98);
    }

    .mark-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .mark-buttons button {
      flex: 1;
      padding: 14px;
      font-size: 15px;
      font-weight: 600;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: transparent;
      color: white;
    }

    .mark-buttons button:active {
      background: rgba(255,255,255,0.2);
      transform: scale(0.98);
    }

    .stats {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 12px 16px;
      text-align: center;
      color: white;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .menu-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      z-index: 1000;
      transition: transform 0.2s;
    }

    .menu-toggle:active {
      transform: scale(0.95);
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .drawer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-radius: 20px 20px 0 0;
      padding: 24px;
      max-height: 80%;
      overflow-y: auto;
      z-index: 1001;
      transform: translateY(100%);
      transition: transform 0.3s;
    }

    .drawer.active {
      transform: translateY(0);
    }

    .drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .drawer-header h2 {
      margin: 0;
      font-size: 22px;
      color: #1a1a1a;
    }

    .close-drawer {
      background: #f0f0f0;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .drawer-section {
      margin-bottom: 24px;
    }

    .drawer-section label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1a1a1a;
      font-size: 14px;
    }

    .drawer-section input[type="file"],
    .drawer-section input[type="text"],
    .drawer-section textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
    }

    .drawer-section textarea {
      min-height: 100px;
      resize: vertical;
    }

    .drawer-section input:focus,
    .drawer-section textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .drawer-section button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
      flex: 1;
    }

    .btn-primary:active {
      background: #5568d3;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #1a1a1a;
      flex: 1;
    }

    .btn-secondary:active {
      background: #e0e0e0;
    }

    .btn-ghost {
      background: transparent;
      color: #667eea;
      border: 2px solid #667eea;
      flex: 1;
    }

    .btn-ghost:active {
      background: rgba(102, 126, 234, 0.1);
    }

    .helper-text {
      font-size: 13px;
      color: #666;
      margin-top: 6px;
    }

    .divider {
      height: 1px;
      background: #e0e0e0;
      margin: 20px 0;
    }

    .quiz-card {
      background: white;
      border-radius: 20px;
      padding: 32px 24px;
      width: 100%;
      min-height: 280px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .quiz-question {
      font-size: 20px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .quiz-option {
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: white;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-weight: 500;
    }

    .quiz-option:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
    }

    .quiz-option.selected {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.1);
    }

    .quiz-option.correct {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    .quiz-option.incorrect {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .quiz-option:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .quiz-feedback {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
      font-weight: 600;
      font-size: 16px;
    }

    .quiz-feedback.correct {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
    }

    .quiz-feedback.incorrect {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }

    .quiz-controls {
      margin-bottom: 16px;
    }

    .footer {
      text-align: center;
      padding: 16px 0;
      color: rgba(255,255,255,0.8);
      font-size: 13px;
    }

    code {
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    @media (max-width: 360px) {
      .card {
        height: 240px;
      }

      .card-face {
        font-size: 18px;
        padding: 24px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
   <script>
     // ===================== DATA SDK ===================== //

(function () {
  const STORAGE_KEY = "flash_app_storage_v1";

  function loadRaw() {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : {};
  }

  function saveRaw(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  const dataSdk = {
    saveDeck(name, cards) {
      const db = loadRaw();
      db.decks = db.decks || {};
      db.decks[name] = cards;
      db.lastDeck = name;
      saveRaw(db);
    },

    loadDeck(name) {
      const db = loadRaw();
      return db.decks ? db.decks[name] : null;
    },

    loadAllDeckNames() {
      const db = loadRaw();
      return db.decks ? Object.keys(db.decks) : [];
    },

    deleteDeck(name) {
      const db = loadRaw();
      if (db.decks && db.decks[name]) {
        delete db.decks[name];
        saveRaw(db);
      }
    },

    getLastDeckName() {
      const db = loadRaw();
      return db.lastDeck || null;
    },

    // Save config (title, messages, etc.)
    saveConfig(config) {
      const db = loadRaw();
      db.config = config;
      saveRaw(db);
    },

    loadConfig() {
      const db = loadRaw();
      return db.config || null;
    }
  };

  window.dataSdk = dataSdk;
})();
  </script>
  <script src="tailwindcss.js" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 id="appTitle">Flashcards</h1>
   </div>
   <div class="tabs"><button class="tab active" id="studyTab">Study</button> <button class="tab" id="quizTab">Quiz</button>
   </div>
   <div class="deck-info">
    <div class="deck-name" id="deckName">
     No deck loaded
    </div>
    <div class="position" id="position">
     0 / 0
    </div>
   </div>
   <div id="studyMode">
    <div class="card-container">
     <div id="card" class="card" role="button" aria-label="Flashcard">
      <div class="card-face front" id="frontFace">
       Load a deck to begin
      </div>
      <div class="card-face back" id="backFace"></div>
     </div>
    </div>
    <div class="nav-buttons"><button class="btn-prev" id="prevBtn">← Prev</button> <button class="btn-flip" id="flipBtn">Flip</button> <button class="btn-next" id="nextBtn">Next →</button>
    </div>
    <div class="mark-buttons"><button id="markKnown">✓ Known</button> <button id="markUnsure">? Unsure</button>
    </div>
    <div class="stats" id="stats">
     Known: 0 · Unsure: 0
    </div>
   </div>
   <div id="quizMode" style="display: none;">
    <div class="card-container">
     <div class="quiz-card">
      <div class="quiz-question" id="quizQuestion">
       Load a deck to start quiz
      </div>
      <div class="quiz-options" id="quizOptions"></div>
     </div>
    </div>
    <div class="quiz-feedback" id="quizFeedback" style="display: none;"></div>
    <div class="quiz-controls"><button class="btn-primary" id="nextQuizBtn" style="display: none; width: 100%; padding: 16px; font-size: 16px; font-weight: 600; border: none; border-radius: 12px; cursor: pointer; background: white; color: #667eea;">Next Question</button>
    </div>
    <div class="quiz-results" id="quizResults" style="display: none;">
     <div style="text-align: center; background: white; border-radius: 20px; padding: 32px; margin-bottom: 16px;">
      <h2 style="margin: 0 0 16px 0; font-size: 24px; color: #1a1a1a;">Quiz Complete!</h2>
      <div id="quizScore" style="font-size: 48px; font-weight: 700; color: #667eea; margin-bottom: 8px;">
       0/0
      </div>
      <div id="quizPercent" style="font-size: 18px; color: #666; margin-bottom: 24px;">
       0%
      </div><button id="restartQuiz" style="padding: 16px 32px; font-size: 16px; font-weight: 600; border: none; border-radius: 12px; cursor: pointer; background: #667eea; color: white;">Restart Quiz</button>
     </div>
    </div>
   </div>
   <div class="footer" id="footerText">
    Made for JSON flashcards
   </div>
  </div><button class="menu-toggle" id="menuToggle" aria-label="Open menu">⚙️</button>
  <div class="overlay" id="overlay"></div>
  <div class="drawer" id="drawer">
   <div class="drawer-header">
    <h2>Load Deck</h2><button class="close-drawer" id="closeDrawer" aria-label="Close menu">✕</button>
   </div>
   <div class="drawer-section"><label for="fileInput">Upload JSON file</label> <input type="file" id="fileInput" accept=".json,application/json">
   </div>
   <div class="drawer-section"><label for="pasteJson">Paste JSON</label> <textarea id="pasteJson" placeholder="[{&quot;front&quot;:&quot;Question&quot;,&quot;back&quot;:&quot;Answer&quot;}]"></textarea>
    <div class="button-group"><button class="btn-primary" id="loadPaste">Load</button> <button class="btn-secondary" id="clearPaste">Clear</button>
    </div>
   </div>
   <div class="drawer-section"><label for="urlInput">Load from URL</label> <input type="text" id="urlInput" placeholder="https://example.com/cards.json">
    <div class="button-group"><button class="btn-primary" id="loadUrl">Fetch</button>
    </div>
    <div class="helper-text">
     CORS must allow fetch from your browser
    </div>
   </div>
   <div class="divider"></div>
   <div class="drawer-section"><label for="searchInput">Search cards</label> <input type="text" id="searchInput" placeholder="Search front or back...">
   </div>
   <div class="drawer-section"><label>Actions</label>
    <div class="button-group"><button class="btn-ghost" id="shuffle">Shuffle</button> <button class="btn-ghost" id="exportJson">Export</button> <button class="btn-ghost" id="clearDeck">Clear</button>
    </div>
   </div>
   <div class="helper-text">
    Tip: JSON should be an array with <code>front</code> and <code>back</code> keys. Use arrow keys ← → and Space to navigate.
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: "Flashcards",
      empty_state_text: "Load a deck to begin",
      footer_text: "Made for JSON flashcards"
    };

    let config = { ...defaultConfig };
    let deck = [];
    let filteredDeck = [];
    let currentIndex = 0;
    let isFlipped = false;
    let knownCards = new Set();
    let unsureCards = new Set();
    let currentMode = 'study';
    let quizDeck = [];
    let quizIndex = 0;
    let quizScore = 0;
    let currentAnswer = null;

    const elements = {
      card: document.getElementById('card'),
      frontFace: document.getElementById('frontFace'),
      backFace: document.getElementById('backFace'),
      deckName: document.getElementById('deckName'),
      position: document.getElementById('position'),
      stats: document.getElementById('stats'),
      appTitle: document.getElementById('appTitle'),
      footerText: document.getElementById('footerText'),
      menuToggle: document.getElementById('menuToggle'),
      overlay: document.getElementById('overlay'),
      drawer: document.getElementById('drawer'),
      closeDrawer: document.getElementById('closeDrawer'),
      fileInput: document.getElementById('fileInput'),
      pasteJson: document.getElementById('pasteJson'),
      urlInput: document.getElementById('urlInput'),
      searchInput: document.getElementById('searchInput')
    };

    function updateUI() {
      elements.appTitle.textContent = config.app_title || defaultConfig.app_title;
      elements.footerText.textContent = config.footer_text || defaultConfig.footer_text;
      
      if (currentMode === 'study') {
        if (filteredDeck.length === 0) {
          elements.frontFace.textContent = config.empty_state_text || defaultConfig.empty_state_text;
          elements.backFace.textContent = '';
          elements.deckName.textContent = 'No deck loaded';
          elements.position.textContent = '0 / 0';
        } else {
          const card = filteredDeck[currentIndex];
          elements.frontFace.textContent = card.front || '';
          elements.backFace.textContent = card.back || '';
          elements.deckName.textContent = `Deck: ${filteredDeck.length} cards`;
          elements.position.textContent = `${currentIndex + 1} / ${filteredDeck.length}`;
        }
        elements.stats.textContent = `Known: ${knownCards.size} · Unsure: ${unsureCards.size}`;
      } else {
        updateQuizUI();
      }
    }

    function generateQuiz() {
      if (deck.length < 2) {
        document.getElementById('quizQuestion').textContent = 'Need at least 2 cards to create a quiz';
        return;
      }
      
      quizDeck = [...deck].sort(() => Math.random() - 0.5);
      quizIndex = 0;
      quizScore = 0;
      document.getElementById('quizResults').style.display = 'none';
      showQuizQuestion();
    }

    function showQuizQuestion() {
      if (quizIndex >= quizDeck.length) {
        showQuizResults();
        return;
      }

      const question = quizDeck[quizIndex];
      currentAnswer = question.back;
      
      document.getElementById('quizQuestion').textContent = question.front;
      document.getElementById('quizFeedback').style.display = 'none';
      document.getElementById('nextQuizBtn').style.display = 'none';
      
      // Generate options: correct answer + 3 random wrong answers
      const options = [question.back];
      const otherCards = deck.filter(c => c.back !== question.back);
      
      while (options.length < 4 && otherCards.length > 0) {
        const randomIndex = Math.floor(Math.random() * otherCards.length);
        const wrongAnswer = otherCards[randomIndex].back;
        if (!options.includes(wrongAnswer)) {
          options.push(wrongAnswer);
        }
        otherCards.splice(randomIndex, 1);
      }
      
      // Shuffle options
      options.sort(() => Math.random() - 0.5);
      
      // Render options
      const optionsContainer = document.getElementById('quizOptions');
      optionsContainer.innerHTML = '';
      
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'quiz-option';
        btn.textContent = option;
        btn.addEventListener('click', () => checkAnswer(option, btn));
        optionsContainer.appendChild(btn);
      });
    }

    function checkAnswer(selectedAnswer, selectedButton) {
      const isCorrect = selectedAnswer === currentAnswer;
      
      if (isCorrect) {
        quizScore++;
        selectedButton.classList.add('correct');
        const feedback = document.getElementById('quizFeedback');
        feedback.textContent = '✓ Correct!';
        feedback.className = 'quiz-feedback correct';
        feedback.style.display = 'block';
      } else {
        selectedButton.classList.add('incorrect');
        const feedback = document.getElementById('quizFeedback');
        feedback.textContent = `✗ Incorrect. The answer was: ${currentAnswer}`;
        feedback.className = 'quiz-feedback incorrect';
        feedback.style.display = 'block';
        
        // Highlight correct answer
        document.querySelectorAll('.quiz-option').forEach(btn => {
          if (btn.textContent === currentAnswer) {
            btn.classList.add('correct');
          }
        });
      }
      
      // Disable all options
      document.querySelectorAll('.quiz-option').forEach(btn => {
        btn.disabled = true;
      });
      
      document.getElementById('nextQuizBtn').style.display = 'block';
      updateQuizProgress();
    }

    function showQuizResults() {
      document.getElementById('quizResults').style.display = 'block';
      document.querySelector('.quiz-card').style.display = 'none';
      document.getElementById('quizFeedback').style.display = 'none';
      document.getElementById('nextQuizBtn').style.display = 'none';
      
      const percentage = Math.round((quizScore / quizDeck.length) * 100);
      document.getElementById('quizScore').textContent = `${quizScore}/${quizDeck.length}`;
      document.getElementById('quizPercent').textContent = `${percentage}%`;
    }

    function updateQuizProgress() {
      elements.deckName.textContent = `Quiz Mode`;
      elements.position.textContent = `${quizIndex + 1} / ${quizDeck.length}`;
    }

    function updateQuizUI() {
      if (quizDeck.length === 0) {
        elements.deckName.textContent = 'No quiz';
        elements.position.textContent = '0 / 0';
      } else {
        updateQuizProgress();
      }
    }

    function flipCard() {
      isFlipped = !isFlipped;
      elements.card.classList.toggle('flipped', isFlipped);
    }

    function nextCard() {
      if (filteredDeck.length === 0) return;
      currentIndex = (currentIndex + 1) % filteredDeck.length;
      isFlipped = false;
      elements.card.classList.remove('flipped');
      updateUI();
    }

    function prevCard() {
      if (filteredDeck.length === 0) return;
      currentIndex = (currentIndex - 1 + filteredDeck.length) % filteredDeck.length;
      isFlipped = false;
      elements.card.classList.remove('flipped');
      updateUI();
    }

    function loadDeck(cards) {
      if (!Array.isArray(cards)) {
        showError('Invalid JSON: must be an array');
        return;
      }
      deck = cards;
      filteredDeck = [...deck];
      currentIndex = 0;
      isFlipped = false;
      knownCards.clear();
      unsureCards.clear();
      elements.card.classList.remove('flipped');
      updateUI();
      closeMenu();
    }

    function showError(message) {
      elements.frontFace.textContent = `Error: ${message}`;
      elements.backFace.textContent = '';
    }

    function openMenu() {
      elements.overlay.classList.add('active');
      elements.drawer.classList.add('active');
    }

    function closeMenu() {
      elements.overlay.classList.remove('active');
      elements.drawer.classList.remove('active');
    }

    // Event listeners
    elements.card.addEventListener('click', flipCard);
    document.getElementById('flipBtn').addEventListener('click', flipCard);
    document.getElementById('nextBtn').addEventListener('click', nextCard);
    document.getElementById('prevBtn').addEventListener('click', prevCard);

    document.getElementById('markKnown').addEventListener('click', () => {
      if (filteredDeck.length === 0) return;
      const cardId = currentIndex;
      knownCards.add(cardId);
      unsureCards.delete(cardId);
      updateUI();
      nextCard();
    });

    document.getElementById('markUnsure').addEventListener('click', () => {
      if (filteredDeck.length === 0) return;
      const cardId = currentIndex;
      unsureCards.add(cardId);
      knownCards.delete(cardId);
      updateUI();
      nextCard();
    });

    elements.menuToggle.addEventListener('click', openMenu);
    elements.closeDrawer.addEventListener('click', closeMenu);
    elements.overlay.addEventListener('click', closeMenu);

    elements.fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          loadDeck(data);
        } catch (err) {
          showError('Failed to parse JSON file');
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('loadPaste').addEventListener('click', () => {
      try {
        const data = JSON.parse(elements.pasteJson.value);
        loadDeck(data);
      } catch (err) {
        showError('Invalid JSON in paste area');
      }
    });

    document.getElementById('clearPaste').addEventListener('click', () => {
      elements.pasteJson.value = '';
    });

    document.getElementById('loadUrl').addEventListener('click', async () => {
      const url = elements.urlInput.value.trim();
      if (!url) return;
      try {
        const response = await fetch(url);
        const data = await response.json();
        loadDeck(data);
      } catch (err) {
        showError('Failed to fetch URL');
      }
    });

    document.getElementById('shuffle').addEventListener('click', () => {
      if (deck.length === 0) return;
      filteredDeck = [...deck].sort(() => Math.random() - 0.5);
      currentIndex = 0;
      isFlipped = false;
      elements.card.classList.remove('flipped');
      updateUI();
      closeMenu();
    });

    document.getElementById('exportJson').addEventListener('click', () => {
      if (deck.length === 0) return;
      const json = JSON.stringify(deck, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'flashcards.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('clearDeck').addEventListener('click', () => {
      deck = [];
      filteredDeck = [];
      currentIndex = 0;
      isFlipped = false;
      knownCards.clear();
      unsureCards.clear();
      elements.card.classList.remove('flipped');
      updateUI();
      closeMenu();
    });

    elements.searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      if (!query) {
        filteredDeck = [...deck];
      } else {
        filteredDeck = deck.filter(card => 
          (card.front && card.front.toLowerCase().includes(query)) ||
          (card.back && card.back.toLowerCase().includes(query))
        );
      }
      currentIndex = 0;
      isFlipped = false;
      elements.card.classList.remove('flipped');
      updateUI();
    });

    // Tab switching
    document.getElementById('studyTab').addEventListener('click', () => {
      currentMode = 'study';
      document.getElementById('studyTab').classList.add('active');
      document.getElementById('quizTab').classList.remove('active');
      document.getElementById('studyMode').style.display = 'block';
      document.getElementById('quizMode').style.display = 'none';
      updateUI();
    });

    document.getElementById('quizTab').addEventListener('click', () => {
      currentMode = 'quiz';
      document.getElementById('quizTab').classList.add('active');
      document.getElementById('studyTab').classList.remove('active');
      document.getElementById('studyMode').style.display = 'none';
      document.getElementById('quizMode').style.display = 'block';
      generateQuiz();
      updateUI();
    });

    document.getElementById('nextQuizBtn').addEventListener('click', () => {
      quizIndex++;
      document.querySelector('.quiz-card').style.display = 'block';
      showQuizQuestion();
    });

    document.getElementById('restartQuiz').addEventListener('click', () => {
      generateQuiz();
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (currentMode === 'study') {
        if (e.key === 'ArrowRight') nextCard();
        if (e.key === 'ArrowLeft') prevCard();
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          flipCard();
        }
      }
    });

    // Element SDK implementation
    async function onConfigChange(newConfig) {
      config = { ...newConfig };
      updateUI();
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ['app_title', cfg.app_title || defaultConfig.app_title],
        ['empty_state_text', cfg.empty_state_text || defaultConfig.empty_state_text],
        ['footer_text', cfg.footer_text || defaultConfig.footer_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });

      config = { ...window.elementSdk.config };
    }

    // Initialize UI
    updateUI();
  </script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("service-worker.js")
      .catch(err => console.error("SW registration failed:", err));
  }
</script>
 </body>
</html>
